---

archcodex.common.errors:
  inherits: archcodex.common
  mixins:
    - tested
  description: Error types and codes - the error contract
  rationale: |
    Error type definitions and error codes used throughout the application.
    Provides consistent error handling with structured, serializable errors.

    Use for: Error classes, error codes, and error utility functions.
    Don't use for: Throwing errors (that happens where errors occur).
  constraints:
    - rule: max_file_lines
      value: 200
      exclude_comments: true
      severity: warning
      why: Error definitions can be extensive but should stay focused
    # Coverage: Every error code must be used somewhere in the codebase
    - rule: require_coverage
      value:
        source_type: object_keys
        source_pattern: "ErrorCodes"
        in_files: "src/utils/errors.ts"
        target_pattern: "ErrorCodes.${value}"
        in_target_files: "src/**/*.ts"
      severity: warning
      why: Error codes should be used; unused codes indicate dead code
  reference_implementations:
    - src/utils/errors.ts
  file_pattern: errors.ts
  code_pattern: |-
    /**
     * @arch archcodex.common.errors
     *
     * Error types and codes for the application.
     * All errors should extend the base error class.
     */

    /** Base error class with structured error codes. */
    export class AppError extends Error {
      constructor(
        public readonly code: string,
        message: string,
        public readonly details?: Record<string, unknown>
      ) {
        super(message);
        this.name = 'AppError';
        Error.captureStackTrace(this, this.constructor);
      }

      toJSON(): Record<string, unknown> {
        return {
          name: this.name,
          code: this.code,
          message: this.message,
          details: this.details,
        };
      }
    }

    /** Domain-specific error subclass. */
    export class DomainError extends AppError {
      constructor(code: string, message: string, details?: Record<string, unknown>) {
        super(code, message, details);
        this.name = 'DomainError';
      }
    }

    /** Standard error codes. */
    export const ErrorCodes = {
      NOT_FOUND: 'E001',
      INVALID_INPUT: 'E002',
      PERMISSION_DENIED: 'E003',
    } as const;
  hints:
    - Define error codes as constants
    - Error classes should be simple and serializable
    - Include toJSON() for structured error output
